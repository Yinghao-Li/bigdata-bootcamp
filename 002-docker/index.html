<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Docker - Georgia Tech Big Data Analytics Bootcamp</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Docker";
        var mkdocs_page_input_path = "002-docker.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Georgia Tech Big Data Analytics Bootcamp
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Python Introduction</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../001-python/">Python for Data Analysis</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Environment Setup</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Docker</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#0-system-requirements">0. System requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#1-install-docker">1. Install Docker</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#2-run-docker-image">2. Run Docker image</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#21-start-the-container">2.1. Start the container</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#param-p-host-portvm-port">param -p &lt;host-port&gt;:&lt;vm-port&gt;</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#param-v-volumehost-srccontainer-destoptions">param -v, --volume=[host-src:]container-dest[:&lt;options&gt;]</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#param-it">param -it</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#param-h-bootcamplocal">param -h bootcamp.local</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#param-m-8192m">param -m 8192m</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#22-start-all-necessary-services">2.2. Start all necessary services</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#23-stop-all-services">2.3. Stop all services</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#24-detach-or-exit">2.4. Detach or Exit</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#25-re-attach">2.5. Re-attach</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#26-destroy-instance">2.6. Destroy instance</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#27-destroy-images">2.7. Destroy images</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#28-update-images">2.8. Update images</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#29-official-documentations">2.9. Official documentations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#210-optional-use-docker-compose">2.10. Optional: use docker-compose</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#3-configurations-and-logs">3. Configurations and logs</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#31-system-configurations">3.1. System Configurations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#32-logs">3.2. Logs</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../003-zeppelin/">Zeppelin</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Scala and Spark</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../004-scala/">Scala Basics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../005-spark/">Spark Basics</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Georgia Tech Big Data Analytics Bootcamp</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Environment Setup</li>
      <li class="breadcrumb-item active">Docker</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="environment-setup">Environment Setup</h1>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>For the purpose of the environment normalization, we provide a simple <a href="https://docs.docker.com/">docker</a> image for you, which contains most of the software required by this course. We also provide a few scripts to install some optional packages.</p>
</div>
<p>The whole progress would seem as follow:</p>
<ol>
<li><strong>Make sure you have enough resources</strong>:<ul>
<li>It requires at least 8GB of Physical RAM; 16GB or larger would be better</li>
<li>It requires at least 15GB of hard disk storage</li>
</ul>
</li>
<li>Install a docker environment in the local machine</li>
<li>Start Docker Service, pull images, and create an instance</li>
<li>Just rock it!</li>
<li>Destroy the containers and images if they are no longer needed</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Since this docker image integrated many related services for the course, it requires at least 4GB RAM for this virtual machine.
If you can not meet the minimum requirement, the system could randomly kill one or a few processes due to resource limitation, which causes a lot of strange errors which is even unable to reproduce.</p>
<p><strong>DO NOT TRY TO DO THAT.</strong>  </p>
<p>Instead, you can use cloud platforms such as <a href="https://azure.microsoft.com/en-us/">Azure</a>.</p>
</div>
<h2 id="0-system-requirements">0. System requirements</h2>
<p>You should have enough system resources if you plan to start a container in your local OS.</p>
<p>You need to reserve at least 4 GB RAM for Docker and some extra memory for the host machine.
However, you can still start all the Hadoop-related services except <a href="https://zeppelin.apache.org">Zeppelin</a>, even if you only reserve 4GB for the virtual machine.</p>
<h2 id="1-install-docker">1. Install Docker</h2>
<p>Docker is a software providing operating-system-level virtualization, also known as containers, promoted by the company <a href="docker.com">Docker, Inc.</a>.
Docker uses the resource isolation features of the Linux kernel such as cgroups and kernel namespaces, and a union-capable file system such as OverlayFS and others to allow independent "containers" to run within a single Linux instance, avoiding the overhead of starting and maintaining virtual machines (VMs).
(from <a href="https://en.wikipedia.org/wiki/Docker_(software)">Wikipedia</a>)
Basically, you can treat docker as a lightweight virtual machine with pretty high performance.</p>
<p>The installation instructions for different operating systems are provided in the links below.
You can also check the official documentation <a href="https://docs.docker.com/engine/installation/">here</a> to get the latest news and detailed explanations.</p>
<ul>
<li><a href="../0022-docker-linux/">Install Docker In Linux</a></li>
<li><a href="../0023-docker-macos/">Install Docker In macOS</a></li>
<li><a href="../0021-docker-windows/">Install Docker In Microsoft Windows</a></li>
</ul>
<p>Once the docker is installed, you can start your docker services and launch your docker container using the following commands:</p>
<pre><code class="language-bash">docker  # a tool to control docker
</code></pre>
<h2 id="2-run-docker-image">2. Run Docker image</h2>
<h3 id="21-start-the-container">2.1. Start the container</h3>
<p>The command to start the container used in the following tutorials is:</p>
<pre><code class="language-bash">docker run -it --privileged=true \
  --cap-add=SYS_ADMIN \
  -m 8192m -h bootcamp.local \
  --name bigbox -p 2222:22 -p 9530:9530 -p 8888:8888\
  -v /:/mnt/host \
  sunlab/bigbox:latest \
  /bin/bash
</code></pre>
<p>It may take a while for the system to download and extract the container.</p>
<p>In general, the syntax of <code>docker run</code> is </p>
<pre><code class="language-bash">docker run [options] image[:tag|@digest] [command] [args]
</code></pre>
<p>Below explains the options used above:</p>
<h4 id="param-p-host-portvm-port"><kbd>param</kbd> <code>-p &lt;host-port&gt;:&lt;vm-port&gt;</code></h4>
<p>This option is used to map the TCP port <code>vm-port</code> in the container to port <code>host-port</code> on the Docker host.
Currently, the ports are reserved to:</p>
<ul>
<li>8888 - Jupyter Notebook</li>
<li>9530 - Zeppelin Notebook</li>
</ul>
<p>Once you have started the Zeppelin service, this service will keep listening port <code>9530</code> in docker.
You will be able to visit this service using <code>http://127.0.0.1:9530</code> or <code>http://DOCKER_HOST_IP:9530</code>.
The remote IP depends on the Docker Service you are running, which is described above.</p>
<ul>
<li>If you are using Linux or Docker.app in macOS, you can visit "localhost:9530", or other ports if you changed <code>host-port</code></li>
<li>If you are using VirtualBox + macOS or Windows, you should get the Docker's IP first</li>
</ul>
<h4 id="param-v-volumehost-srccontainer-destoptions"><kbd>param</kbd> <code>-v, --volume=[host-src:]container-dest[:&lt;options&gt;]</code></h4>
<p>This option is used to mount a volume.
Currently, we are using <code>-v /:/mnt/host</code>.
In this case, we can visit the root of your file system for your host machine.
If you are using macOS, <code>/mnt/host/Users/&lt;yourname&gt;/</code> would be the <code>$HOME</code> of your MacBook.
If you are using Windows, you can reach your <code>C:</code> disk from <code>/mnt/host/c</code> in docker.</p>
<p>Variable <code>host-src</code> accepts absolute path only.</p>
<h4 id="param-it"><kbd>param</kbd> <code>-it</code></h4>
<ul>
<li>-i              : Keep STDIN open even if not attached</li>
<li>-t              : Allocate a pseudo-tty</li>
</ul>
<h4 id="param-h-bootcamplocal"><kbd>param</kbd> <code>-h bootcamp.local</code></h4>
<p>Once you enter this docker environment, you can ping this docker environment itself as <code>bootcamp.local</code>. This variable is used in some configuration files for Hadoop ecosystems.</p>
<h4 id="param-m-8192m"><kbd>param</kbd> <code>-m 8192m</code></h4>
<p>Memory limit (format: <code>&lt;number&gt;[&lt;unit&gt;]</code>).
The number should be a positive integer.
The unit can be one of <code>b</code>, <code>k</code>, <code>m</code>, or <code>g</code>.</p>
<p>This docker image requires at least 4G of RAM, while 8G is recommended when your physical machine has more than 8G of RAM.
The local machine is not the same as the remote server.
If you are launching a remote server with 8G RAM, you can set this number as 7G.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please refer to the <a href="https://docs.docker.com/engine/reference/run/">official documentation</a> for more information and the detailed explanations.</p>
</div>
<h3 id="22-start-all-necessary-services">2.2. Start all necessary services</h3>
<p>When we have logged into the docker, we can first use the following script.</p>
<pre><code class="language-bash">/scripts/start-services.sh
</code></pre>
<p>This script helps you to start the necessary services for the Hadoop ecosystems.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>In your terminal, you will generally meet two kinds of prompts.</p>
<p>Prompt '#' indices you are root aka the administrator of this environment now<br />
<code>&gt; [root@bootcamp /]# whoami</code> <code>&gt; root</code></p>
<p>Prompt '$' indices you are an ordinary user<br />
<code>&gt; [yu@bootcamp /]$ whoami</code>  <code>&gt; yu</code></p>
<p>You are in the <code>sudo</code> mode by default.
We also assume that you are always in the <code>sudo</code> mode in the following discussions.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You probably will encounter the "Connection Refused" exception if you forget to start these services.</p>
</div>
<p>If you wish to host Zeppelin, you need to install it first by using the command:</p>
<pre><code class="language-bash">/scripts/install-zeppelin.sh
</code></pre>
<p>And start the service with the command:</p>
<pre><code class="language-bash">/scripts/start-zeppelin.sh
</code></pre>
<p>Then, Zeppelin will listen to the port <code>9530</code>.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please refer to the <a href="../003-zeppelin/">Zeppelin tutorial</a> for more information about the configuration and usage of Zeppelin Notebook.</p>
</div>
<p>If you wish to host Jupyter, you can start it by using the command:</p>
<pre><code class="language-bash">/scripts/start-jupyter.sh
</code></pre>
<p>Jupyter will listen to the port <code>8888</code></p>
<h3 id="23-stop-all-services">2.3. Stop all services</h3>
<p>You can stop the running services with:</p>
<pre><code class="language-bash">/scripts/stop-services.sh
</code></pre>
<h3 id="24-detach-or-exit">2.4. Detach or Exit</h3>
<p>To detach and suspend a Docker instance from the terminal, use the command:</p>
<pre><code class="language-bash">ctrl + p, ctrl + q
</code></pre>
<p>To exit,</p>
<pre><code class="language-bash">exit
</code></pre>
<h3 id="25-re-attach">2.5. Re-attach</h3>
<p>If you detached an instance and want to re-attach it, you need to check the <code>CONTAINER ID</code> or <code>NAMES</code> of it first.</p>
<pre><code class="language-bash">$ docker ps -a
CONTAINER ID        IMAGE                  COMMAND                CREATED             STATUS              PORTS                                                                  NAMES
011547e95ef5        sunlab/bigbox:latest   &quot;/tini -- /bin/bash&quot;   6 hours ago         Up 4 seconds        0.0.0.0:8888-&gt;8888/tcp, 0.0.0.0:9530-&gt;9530/tcp, 0.0.0.0:2222-&gt;22/tcp   bigbox
</code></pre>
<p>If the "STATUS" column is similar to "Exited (0) 10 hours ago", you can restart the container:</p>
<pre><code class="language-bash">$ docker start &lt;CONTAINER ID or NAMES&gt;
</code></pre>
<p>And attach it with:</p>
<pre><code class="language-bash">$ docker attach &lt;CONTAINER ID or NAMES&gt;
</code></pre>
<p>Every time you restart your container, you need to re-start the services (section 2.2) before any HDFS related operations.</p>
<h3 id="26-destroy-instance">2.6. Destroy instance</h3>
<p>If you want to permanently remove the container:</p>
<pre><code class="language-bash">$ docker rm &lt;CONTAINER ID or NAMES&gt;
</code></pre>
<h3 id="27-destroy-images">2.7. Destroy images</h3>
<p>If you want to permanently remove any images, you need to list images first:</p>
<pre><code class="language-bash">$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
sunlab/bigbox       latest              bfd258e00de3        16 hours ago        2.65GB
</code></pre>
<p>And remove them by REPOSITORY or IMAGE ID using the command:</p>
<pre><code class="language-bash">$ docker rmi &lt;REPOSITORY or IMAGE ID&gt;
</code></pre>
<h3 id="28-update-images">2.8. Update images</h3>
<pre><code class="language-bash">$ docker pull sunlab/bigbox
</code></pre>
<h3 id="29-official-documentations">2.9. Official documentations</h3>
<p>Please refer to <a href="https://docs.docker.com/v17.09/engine/userguide/storagedriver/imagesandcontainers/">this link</a> for the introduction of images, containers, and storage drivers.</p>
<h3 id="210-optional-use-docker-compose">2.10. Optional: use docker-compose</h3>
<p><a href="https://docs.docker.com/compose/">Docker Compose</a> is a tool for defining and running multi-container Docker applications.
A simple <code>docker-compose.yml</code> could <em>simplify</em> the parameters and make your life easier.</p>
<p>Please refer to <a href="/env/env-docker-compose.html#docker-compose">this page</a> for further instructions.</p>
<h2 id="3-configurations-and-logs">3. Configurations and logs</h2>
<h3 id="31-system-configurations">3.1. System Configurations</h3>
<pre><code class="language-bash">$ cat /proc/meminfo  | grep Mem ## Current Memory
MemTotal:        8164680 kB ## Note: This value shoud no less than 4GB
MemFree:          175524 kB
MemAvailable:    5113340 kB
$ cat /proc/cpuinfo  | grep 'model name' | head -1  ## CPU Brand
model name  : Intel(R) Core(TM) i7-7920HQ CPU @ 3.10GHz
$ cat /proc/cpuinfo  | grep 'model name' | wc -l ## CPU Count
4
$ df -h ## List Current Hard Disk Usage
Filesystem      Size  Used Avail Use% Mounted on
overlay          32G  4.6G   26G  16% /
tmpfs            64M     0   64M   0% /dev
...
$ ps -ef ## List Current Running Process
UID        PID  PPID  C STIME TTY          TIME CMD
root         1     0  0 01:38 pts/0    00:00:00 /tini -- /bin/bash
root         7     1  0 01:38 pts/0    00:00:00 /bin/bash
root        77     1  0 01:43 ?        00:00:00 /usr/sbin/sshd
zookeep+   136     1  0 01:43 ?        00:00:14 /usr/lib/jvm/java-openjdk/bin/java -Dzookeeper.log.dir=/var/log/zookeeper -Dzookeeper.root.logger=INFO,ROLLINGFILE -cp /usr/lib/zookeeper/bin/../build/classes:/
yarn       225     1  0 01:43 ?        00:00:13 /usr/lib/jvm/java/bin/java -Dproc_proxyserver -Xmx1000m -Dhadoop.log.dir=/var/log/hadoop-yarn -Dyarn.log.dir=/var/log/hadoop-yarn -Dhadoop.log.file=yarn-yarn-pr
...
$ lsof -i:9530 ## Find the Process Listening to Some Specific Port
COMMAND  PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
java    3165 zeppelin  189u  IPv4 229945      0t0  TCP *:9530 (LISTEN)
</code></pre>
<h3 id="32-logs">3.2. Logs</h3>
<ul>
<li><strong>hadoop-hdfs</strong> -- /var/log/hadoop-hdfs/*</li>
<li><strong>hadoop-mapreduce</strong>  -- /var/log/hadoop-mapreduce/*</li>
<li><strong>hadoop-yarn</strong> -- /var/log/hadoop-yarn/*</li>
<li><strong>hbase</strong>  --  /var/log/hbase/*</li>
<li><strong>hive</strong>  -- /var/log/hive/*</li>
<li><strong>spark</strong>  -- /var/log/spark/*</li>
<li><strong>zookeeper</strong> -- /var/log/zookeeper/*</li>
<li><strong>zeppelin</strong> -- /usr/local/zeppelin/logs/*</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../001-python/" class="btn btn-neutral float-left" title="Python for Data Analysis"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../003-zeppelin/" class="btn btn-neutral float-right" title="Zeppelin">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../001-python/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../003-zeppelin/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
